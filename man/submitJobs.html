<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>R: Submit jobs or chunks of jobs to batch system via cluster...</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" type="text/css" href="R.css">

<link rel="stylesheet" href="http://yandex.st/highlightjs/7.3/styles/github.min.css">
<script src="http://yandex.st/highlightjs/7.3/highlight.min.js"></script>
<script src="http://yandex.st/highlightjs/7.3/languages/r.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</head><body>

<table width="100%" summary="page for submitJobs {BatchJobs}"><tr><td>submitJobs {BatchJobs}</td><td align="right">R Documentation</td></tr></table>

<h2>Submit jobs or chunks of jobs to batch system via cluster function.</h2>

<h3>Description</h3>

<p>If the internal submit cluster function completes
successfully, the <code>retries</code> counter is set back to 0
and the next job or chunk is submitted. If the internal
submit cluster function returns a fatal error, the submit
process is completely stopped and an exception is thrown.
If the internal submit cluster function returns a temporary
error, the submit process waits for a certain time, which
is determined by calling the user-defined
<code>wait</code>-function with the current <code>retries</code>
counter, the counter is increased by 1 and the same job is
submitted again. If <code>max.retries</code> is reached the
function simply terminates.
</p>
<p>Potential temporary submit warnings and errors are logged
inside your file directory in the file &ldquo;submit.log&rdquo;.
To keep track you can use <code>tail -f
[file.dir]/submit.log</code> in another terminal.
</p>


<h3>Usage</h3>

<pre>
submitJobs(reg, ids, resources = list(), wait, max.retries = 10L,
  chunks.as.arrayjobs = FALSE, job.delay = FALSE)
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>reg</code></td>
<td>
<p>[<code><a href="makeRegistry.html">Registry</a></code>]<br> Registry.</p>
</td></tr>
<tr valign="top"><td><code>ids</code></td>
<td>
<p>[<code>integer</code>]<br> Vector for job id or list
of vectors of chunked job ids.  Only corresponding jobs
are submitted. Chunked jobs will get executed
sequentially as a single job for the scheduler.  Default
is all jobs which were not yet submitted to the batch
system.</p>
</td></tr>
<tr valign="top"><td><code>resources</code></td>
<td>
<p>[<code>list</code>]<br> Required resources for
all batch jobs. The elements of this list (e.g. something
like &ldquo;walltime&rdquo; or &ldquo;nodes&rdquo; are defined by
your template job file.  Defaults can be specified in
your config file.  Default is empty list.</p>
</td></tr>
<tr valign="top"><td><code>wait</code></td>
<td>
<p>[<code>function(retries)</code>]<br> Function that
defines how many seconds should be waited in case of a
temporary error.  Default is exponential back-off with
<code>10*2^retries</code>.</p>
</td></tr>
<tr valign="top"><td><code>max.retries</code></td>
<td>
<p>[<code>integer(1)</code>]<br> Number of times
to submit one job again in case of a temporary error
(like filled queues). Each time <code>wait</code> is called to
wait a certain number of seconds.  Default is 10 times.</p>
</td></tr>
<tr valign="top"><td><code>chunks.as.arrayjobs</code></td>
<td>
<p>[<code>logical(1)</code>]<br> If ids
are passed as a list of chunked job ids, execute jobs in
a chunk as array jobs. Note that your scheduler and your
template must be adjusted to use this option. Default is
<code>FALSE</code>.</p>
</td></tr>
<tr valign="top"><td><code>job.delay</code></td>
<td>
<p>[<code>function(n, i)</code> or
<code>logical(1)</code>]<br> Function that defines how many
seconds a job should be delayed before it starts.  This
is an expert option and only necessary to change when you
want submit extremely many jobs. We then delay the jobs a
bit to write the submit messages as early as possible to
avoid writer starvation.  <code>n</code> is the number of jobs
and <code>i</code> the number of the ith job.  The default
function used with <code>job.delay</code> set to <code>TRUE</code> is
no delay for 100 jobs or less and otherwise
<code>runif(1, 0.1*n, 0.2*n)</code>.  If set to <code>FALSE</code>
(the default) delaying jobs is disabled.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>[<code>integer</code>]. Vector of submitted job ids.
</p>


<h3>Examples</h3>

<pre><code class="r">
reg &lt;- makeRegistry(id=&quot;BatchJobsExample&quot;, file.dir=tempfile(), seed=123)
</code></pre>

<pre><code>## Creating dir: /tmp/Rtmp14EkvD/file3d4b2f0317ec
## Saving registry: /tmp/Rtmp14EkvD/file3d4b2f0317ec/registry.RData
</code></pre>

<pre><code class="r">f &lt;- function(x) x^2
batchMap(reg, f, 1:10)
</code></pre>

<pre><code>## Adding 10 jobs to DB.
</code></pre>

<pre><code class="r">submitJobs(reg)
</code></pre>

<pre><code>## Saving conf: /tmp/Rtmp14EkvD/file3d4b2f0317ec/conf.RData
## Submitting 10 chunks / 10 jobs.
## Cluster functions: Interactive.
## Auto-mailer settings: start=none, done=none, error=none.
## Writing 10 R scripts...
## 2014-02-07 07:55:50: Starting job on node bischl-x1.
## Loading registry: /tmp/Rtmp14EkvD/file3d4b2f0317ec/registry.RData
## Loading conf: /tmp/Rtmp14EkvD/file3d4b2f0317ec/conf.RData
## Auto-mailer settings: start=none, done=none, error=none.
## Setting work dir: /tmp/pkgdocs
## ########## Executing jid=1 ##########
## Timestamp: 2014-02-07 07:55:50
## Setting seed: 123
## Writing result file: /tmp/Rtmp14EkvD/file3d4b2f0317ec/jobs/01/1-result.RData
## 2014-02-07 07:55:51: Job on slave is finished.
## Setting work back to: /tmp/pkgdocs
## Memory usage according to gc:
## 2014-02-07 07:55:51: Starting job on node bischl-x1.
## Loading registry: /tmp/Rtmp14EkvD/file3d4b2f0317ec/registry.RData
## Loading conf: /tmp/Rtmp14EkvD/file3d4b2f0317ec/conf.RData
## Auto-mailer settings: start=none, done=none, error=none.
## Setting work dir: /tmp/pkgdocs
## ########## Executing jid=2 ##########
## Timestamp: 2014-02-07 07:55:51
## Setting seed: 124
## Writing result file: /tmp/Rtmp14EkvD/file3d4b2f0317ec/jobs/02/2-result.RData
## 2014-02-07 07:55:51: Job on slave is finished.
## Setting work back to: /tmp/pkgdocs
## Memory usage according to gc:
## 2014-02-07 07:55:51: Starting job on node bischl-x1.
## Loading registry: /tmp/Rtmp14EkvD/file3d4b2f0317ec/registry.RData
## Loading conf: /tmp/Rtmp14EkvD/file3d4b2f0317ec/conf.RData
## Auto-mailer settings: start=none, done=none, error=none.
## Setting work dir: /tmp/pkgdocs
## ########## Executing jid=3 ##########
## Timestamp: 2014-02-07 07:55:51
## Setting seed: 125
## Writing result file: /tmp/Rtmp14EkvD/file3d4b2f0317ec/jobs/03/3-result.RData
## 2014-02-07 07:55:51: Job on slave is finished.
## Setting work back to: /tmp/pkgdocs
## Memory usage according to gc:
## 2014-02-07 07:55:51: Starting job on node bischl-x1.
## Loading registry: /tmp/Rtmp14EkvD/file3d4b2f0317ec/registry.RData
## Loading conf: /tmp/Rtmp14EkvD/file3d4b2f0317ec/conf.RData
## Auto-mailer settings: start=none, done=none, error=none.
## Setting work dir: /tmp/pkgdocs
## ########## Executing jid=4 ##########
## Timestamp: 2014-02-07 07:55:51
## Setting seed: 126
## Writing result file: /tmp/Rtmp14EkvD/file3d4b2f0317ec/jobs/04/4-result.RData
## 2014-02-07 07:55:51: Job on slave is finished.
## Setting work back to: /tmp/pkgdocs
## Memory usage according to gc:
## 2014-02-07 07:55:51: Starting job on node bischl-x1.
## Loading registry: /tmp/Rtmp14EkvD/file3d4b2f0317ec/registry.RData
## Loading conf: /tmp/Rtmp14EkvD/file3d4b2f0317ec/conf.RData
## Auto-mailer settings: start=none, done=none, error=none.
## Setting work dir: /tmp/pkgdocs
## ########## Executing jid=5 ##########
## Timestamp: 2014-02-07 07:55:51
## Setting seed: 127
## Writing result file: /tmp/Rtmp14EkvD/file3d4b2f0317ec/jobs/05/5-result.RData
## 2014-02-07 07:55:51: Job on slave is finished.
## Setting work back to: /tmp/pkgdocs
## Memory usage according to gc:
## 2014-02-07 07:55:51: Starting job on node bischl-x1.
## Loading registry: /tmp/Rtmp14EkvD/file3d4b2f0317ec/registry.RData
## Loading conf: /tmp/Rtmp14EkvD/file3d4b2f0317ec/conf.RData
## Auto-mailer settings: start=none, done=none, error=none.
## Setting work dir: /tmp/pkgdocs
## ########## Executing jid=6 ##########
## Timestamp: 2014-02-07 07:55:51
## Setting seed: 128
## Writing result file: /tmp/Rtmp14EkvD/file3d4b2f0317ec/jobs/06/6-result.RData
## 2014-02-07 07:55:51: Job on slave is finished.
## Setting work back to: /tmp/pkgdocs
## Memory usage according to gc:
## 2014-02-07 07:55:51: Starting job on node bischl-x1.
## Loading registry: /tmp/Rtmp14EkvD/file3d4b2f0317ec/registry.RData
## Loading conf: /tmp/Rtmp14EkvD/file3d4b2f0317ec/conf.RData
## Auto-mailer settings: start=none, done=none, error=none.
## Setting work dir: /tmp/pkgdocs
## ########## Executing jid=7 ##########
## Timestamp: 2014-02-07 07:55:51
## Setting seed: 129
## Writing result file: /tmp/Rtmp14EkvD/file3d4b2f0317ec/jobs/07/7-result.RData
## 2014-02-07 07:55:51: Job on slave is finished.
## Setting work back to: /tmp/pkgdocs
## Memory usage according to gc:
## 2014-02-07 07:55:52: Starting job on node bischl-x1.
## Loading registry: /tmp/Rtmp14EkvD/file3d4b2f0317ec/registry.RData
## Loading conf: /tmp/Rtmp14EkvD/file3d4b2f0317ec/conf.RData
## Auto-mailer settings: start=none, done=none, error=none.
## Setting work dir: /tmp/pkgdocs
## ########## Executing jid=8 ##########
## Timestamp: 2014-02-07 07:55:52
## Setting seed: 130
## Writing result file: /tmp/Rtmp14EkvD/file3d4b2f0317ec/jobs/08/8-result.RData
## 2014-02-07 07:55:52: Job on slave is finished.
## Setting work back to: /tmp/pkgdocs
## Memory usage according to gc:
## 2014-02-07 07:55:52: Starting job on node bischl-x1.
## Loading registry: /tmp/Rtmp14EkvD/file3d4b2f0317ec/registry.RData
## Loading conf: /tmp/Rtmp14EkvD/file3d4b2f0317ec/conf.RData
## Auto-mailer settings: start=none, done=none, error=none.
## Setting work dir: /tmp/pkgdocs
## ########## Executing jid=9 ##########
## Timestamp: 2014-02-07 07:55:52
## Setting seed: 131
## Writing result file: /tmp/Rtmp14EkvD/file3d4b2f0317ec/jobs/09/9-result.RData
## 2014-02-07 07:55:52: Job on slave is finished.
## Setting work back to: /tmp/pkgdocs
## Memory usage according to gc:
## 2014-02-07 07:55:52: Starting job on node bischl-x1.
## Loading registry: /tmp/Rtmp14EkvD/file3d4b2f0317ec/registry.RData
## Loading conf: /tmp/Rtmp14EkvD/file3d4b2f0317ec/conf.RData
## Auto-mailer settings: start=none, done=none, error=none.
## Setting work dir: /tmp/pkgdocs
## ########## Executing jid=10 ##########
## Timestamp: 2014-02-07 07:55:52
## Setting seed: 132
## Writing result file: /tmp/Rtmp14EkvD/file3d4b2f0317ec/jobs/10/10-result.RData
## 2014-02-07 07:55:52: Job on slave is finished.
## Setting work back to: /tmp/pkgdocs
## Memory usage according to gc:
</code></pre>

<pre><code>## 
SubmitJobs |+                                                |   0% (00:00:00)
SubmitJobs |+++++                                            |  10% (00:00:09)
SubmitJobs |++++++++++                                       |  20% (00:00:04)
SubmitJobs |+++++++++++++++                                  |  30% (00:00:02)
SubmitJobs |++++++++++++++++++++                             |  40% (00:00:01)
SubmitJobs |++++++++++++++++++++++++                         |  50% (00:00:01)
SubmitJobs |+++++++++++++++++++++++++++++                    |  60% (00:00:00)
SubmitJobs |++++++++++++++++++++++++++++++++++               |  70% (00:00:00)
SubmitJobs |+++++++++++++++++++++++++++++++++++++++          |  80% (00:00:00)
SubmitJobs |++++++++++++++++++++++++++++++++++++++++++++     |  90% (00:00:00)
SubmitJobs |+++++++++++++++++++++++++++++++++++++++++++++++++| 100% (00:00:00)
</code></pre>

<pre><code>## Sending 10 submit messages...
## Might take some time, do not interrupt this!
</code></pre>

<pre><code class="r">
# Submit the 10 jobs again, now randomized into 2 chunks:
chunked = chunk(getJobIds(reg), n.chunks=2, shuffle=TRUE)
submitJobs(reg, chunked)
</code></pre>

<pre><code>## Saving conf: /tmp/Rtmp14EkvD/file3d4b2f0317ec/conf.RData
## Submitting 2 chunks / 10 jobs.
## Cluster functions: Interactive.
## Auto-mailer settings: start=none, done=none, error=none.
## Writing 2 R scripts...
## 2014-02-07 07:55:52: Starting job on node bischl-x1.
## Loading registry: /tmp/Rtmp14EkvD/file3d4b2f0317ec/registry.RData
## Loading conf: /tmp/Rtmp14EkvD/file3d4b2f0317ec/conf.RData
## Auto-mailer settings: start=none, done=none, error=none.
## Setting work dir: /tmp/pkgdocs
## 2014-02-07 07:55:52: Waiting 557 secs between msg flushes.
## ########## Executing jid=1 ##########
## Timestamp: 2014-02-07 07:55:52
## Setting seed: 123
## Writing result file: /tmp/Rtmp14EkvD/file3d4b2f0317ec/jobs/01/1-result.RData
## ########## Executing jid=5 ##########
## Timestamp: 2014-02-07 07:55:52
## Setting seed: 127
## Writing result file: /tmp/Rtmp14EkvD/file3d4b2f0317ec/jobs/05/5-result.RData
## ########## Executing jid=6 ##########
## Timestamp: 2014-02-07 07:55:52
## Setting seed: 128
## Writing result file: /tmp/Rtmp14EkvD/file3d4b2f0317ec/jobs/06/6-result.RData
## ########## Executing jid=8 ##########
## Timestamp: 2014-02-07 07:55:52
## Setting seed: 130
## Writing result file: /tmp/Rtmp14EkvD/file3d4b2f0317ec/jobs/08/8-result.RData
## ########## Executing jid=10 ##########
## Timestamp: 2014-02-07 07:55:52
## Setting seed: 132
## Writing result file: /tmp/Rtmp14EkvD/file3d4b2f0317ec/jobs/10/10-result.RData
## 2014-02-07 07:55:52: Job on slave is finished.
## Setting work back to: /tmp/pkgdocs
## Memory usage according to gc:
## 2014-02-07 07:55:53: Starting job on node bischl-x1.
## Loading registry: /tmp/Rtmp14EkvD/file3d4b2f0317ec/registry.RData
## Loading conf: /tmp/Rtmp14EkvD/file3d4b2f0317ec/conf.RData
## Auto-mailer settings: start=none, done=none, error=none.
## Setting work dir: /tmp/pkgdocs
## 2014-02-07 07:55:53: Waiting 382 secs between msg flushes.
## ########## Executing jid=2 ##########
## Timestamp: 2014-02-07 07:55:53
## Setting seed: 124
## Writing result file: /tmp/Rtmp14EkvD/file3d4b2f0317ec/jobs/02/2-result.RData
## ########## Executing jid=3 ##########
## Timestamp: 2014-02-07 07:55:53
## Setting seed: 125
## Writing result file: /tmp/Rtmp14EkvD/file3d4b2f0317ec/jobs/03/3-result.RData
## ########## Executing jid=4 ##########
## Timestamp: 2014-02-07 07:55:53
## Setting seed: 126
## Writing result file: /tmp/Rtmp14EkvD/file3d4b2f0317ec/jobs/04/4-result.RData
## ########## Executing jid=7 ##########
## Timestamp: 2014-02-07 07:55:53
## Setting seed: 129
## Writing result file: /tmp/Rtmp14EkvD/file3d4b2f0317ec/jobs/07/7-result.RData
## ########## Executing jid=9 ##########
## Timestamp: 2014-02-07 07:55:53
## Setting seed: 131
## Writing result file: /tmp/Rtmp14EkvD/file3d4b2f0317ec/jobs/09/9-result.RData
## 2014-02-07 07:55:53: Job on slave is finished.
## Setting work back to: /tmp/pkgdocs
## Memory usage according to gc:
</code></pre>

<pre><code>## 
SubmitJobs |+                                                |   0% (00:00:00)
SubmitJobs |++++++++++++++++++++++++                         |  50% (00:00:00)
SubmitJobs |+++++++++++++++++++++++++++++++++++++++++++++++++| 100% (00:00:00)
</code></pre>

<pre><code>## Sending 2 submit messages...
## Might take some time, do not interrupt this!
</code></pre>

<pre><code class="r">
</code></pre>


<hr><div align="center">[Package <em>BatchJobs</em> version 1.2 <a href="00Index.html">Index</a>]</div>
</body></html>
